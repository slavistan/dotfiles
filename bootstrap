#!/usr/bin/env -S sh -ue

if [ ${1:-x} = "-h" ] || [ ${1:-x} = "--help" ];
	cat <<EOF

EOF
	exit
fi


# hack sudo to use PW envvar; must be defined.
if [ ${PW+x} ]; then
	echo "Envvar 'PW' must contain sudo password. Abort." >&2
	exit 1
fi
sudo() {
	echo "$PW" | /bin/sudo -Sp '' "$@"
}

# TODO: Check that script is run as a regular user
# TODO: Record progress of installation

rootdir="$(realpath "$(dirname "$0")")"
cd "$rootdir"

echo "$@" | while read target; do
	if [ -f "$target" ]; then
		break;
	elif [ -d "$target" ] && [ -f "$target/bootstrap" ]; then
		# don't use subshell in case we source something
		cd "$target"
		. "./bootstrap"
		cd "$rootdir"
	else
		echo "File '$target/bootstrap' doesn't exist. Abort." >&2
		exit 1
	fi
done
